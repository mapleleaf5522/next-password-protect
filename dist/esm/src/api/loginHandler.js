import{__awaiter as o,__generator as e,__assign as r}from"../../node_modules/tslib/tslib.es6.js";import n from"../../node_modules/jsonwebtoken/index.js";import i from"../../node_modules/safe-compare/index.js";import{sendJson as t}from"./sendJson.js";import{setCookie as s}from"./setCookie.js";var d=function(d,a){return function(m,u){return o(void 0,void 0,void 0,(function(){var o;return e(this,(function(e){u.setHeader("Content-Type","application/json");try{if("POST"!==m.method)throw new Error("Invalid method.");if(!m.body.password)throw new Error("Invalid request.");if(o=m.body.password,i(o,d))return s(u,(null==a?void 0:a.cookieName)||"next-password-protect",n.sign({},d),r({domain:null==a?void 0:a.domain,httpOnly:!0,sameSite:(null==a?void 0:a.cookieSameSite)||!1,secure:void 0!==(null==a?void 0:a.cookieSecure)?null==a?void 0:a.cookieSecure:"production"===process.env.NODE_ENV,path:"/"},(null==a?void 0:a.cookieMaxAge)?{maxAge:null==a?void 0:a.cookieMaxAge}:{})),t(u,200),[2];t(u,400,{message:"Incorrect password."})}catch(o){t(u,500,{message:o.message||"An error has occured."})}return[2]}))}))}};export{d as loginHandler};
//# sourceMappingURL=loginHandler.js.map
